# ログ設計ドキュメント

## 1. ログフォーマット
- 形式: JSON（構造化ログ）
- フィールド例:

| フィールド名 | 型     | 説明                     |
|--------------|--------|--------------------------|
| timestamp    | string | ログ発生時刻 (ISO8601)    |
| level        | string | ログレベル (INFO, ERROR)  |
| service      | string | サービス名                |
| traceId      | string | トレースID                |
| message      | string | ログメッセージ            |
| context      | object | ユーザーIDなど任意情報    |

## 2. 出力ルール
- 例外はスタックトレースを必ず含める
- 重要イベントは必ずログに残す
- 機密情報は含めない
- ログメッセージはチームで統一する（英語）

## 3. 運用ルール
- Filebeatでログ収集、Elasticsearchに送信
- Kibanaで検索・ダッシュボード作成
- エラーログはアラート設定する
- ログローテーションと保管期間を設定する

## 4. ELK構成図

以下はシステムのログ収集・可視化の流れを表した簡易図です。

```
┌───────────────┐
│ ユーザー（ブラウザ） │
└───────┬───────┘
│ HTTPアクセス
▼
┌─────────────────────────┐
│ Spring Boot 掲示板アプリ │
│ - Logbackでログファイル出力 │
└─────────┬─────────────┘
│ ファイルにログ出力
▼
┌─────────┐
│ logs/app.log │
└─────┬──────┘
│ Filebeatが監視
▼
┌───────────────┐
│ Filebeat（ログ収集エージェント）│
│ - ログファイル監視 │
│ - Elasticsearchへ転送 │
└───────────────┘
│
▼
┌─────────────────────────┐
│ Elasticsearch（全文検索DB） │
│ - 構造化ログ保存 │
└───────────────┬─────────┘
│
▼
┌─────────────────────────┐
│ Kibana（ログ可視化UI） │
│ - 検索・フィルタ・ダッシュボード │
└─────────────────────────┘

```


## 5. 用語
- TraceId: 複数サービスのログを紐づける一意ID
- LogLevel: DEBUG < INFO < WARN < ERROR < FATAL

## 6. 参考
- https://www.elastic.co/guide/en/logstash/current/logging-best-practices.html

